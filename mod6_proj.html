<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Module 6 Project</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">BIOL 3140</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Phase I</li>
    <li>
      <a href="phaseI_rubric.html">Phase I report rubric</a>
    </li>
    <li>
      <a href="mod1_proj.html">Module 1 Project</a>
    </li>
    <li>
      <a href="mod2_proj.html">Module 2 Project</a>
    </li>
    <li>
      <a href="mod3_proj.html">Module 3 Project</a>
    </li>
    <li>
      <a href="mod4_proj.html">Module 4 Project</a>
    </li>
    <li>
      <a href="mod5_proj.html">Module 5 Project</a>
    </li>
    <li class="dropdown-header">Phase II</li>
    <li>
      <a href="phaseII_rubric.html">Phase II report rubric</a>
    </li>
    <li>
      <a href="mod6_proj.html">Module 6 Project</a>
    </li>
    <li>
      <a href="mod7_proj.html">Module 7 Project</a>
    </li>
    <li>
      <a href="mod8_proj.html">Module 8 Project</a>
    </li>
    <li>
      <a href="mod9_proj.html">Module 9 Project</a>
    </li>
    <li class="dropdown-header">Phase III</li>
    <li>
      <a href="phaseIII_rubric.html">Phase III report rubric</a>
    </li>
    <li>
      <a href="final_proj.html">Final Project</a>
    </li>
    <li class="dropdown-header">DaqPacks</li>
    <li>
      <a href="daqpack.html">DaqPack Item List</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/orgs/bcorgbio/teams/biol3140_f22">BIOL 3140 Discussion</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Module 6 Project</h1>

</div>


<style>
div.green { background-color:#c7d1c0; border-radius: 5px; padding: 20px;}
</style>
<!-- Add icon library -->
<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"></p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Butterflies and moths (the Lepidoptera) are an exceptional <a
href="https://en.wikipedia.org/wiki/Evolutionary_radiation">radiation</a>
of insects, comprising nearly 160,000 described extant species. (For
context, the vertebrates comprise just 70,000 species or so.) The
Lepidoptera play a fundamental role in almost every terrestrial
ecosystem. These ecologically important species use paired wings to
power flight in search of places to lay eggs, feed on nectar and other
resources, and find mates. The airy environment in which moths and
butterflies fly undoubtedly exerts natural selective pressure on wing
size and shape. However, it appears as if the hind- and forewings have
different roles to play in powered flight and the ecology of the
Lepidoptera. If hindwings are removed from butterflies, they are able to
fly, but at the cost of speed and maneuverability (Jantzen and Eisner
2008). Therefore, it has been proposed that forewing shape and size may
be the result of stabilizing selection imposed by the physical and fluid
requirements of flight and hindwing shape and size may be determined
more by neutral selection, sexual selection, or selection due to
predator avoidance (Sourakov 2013, Barber et al. 2015, Willmott et
al. 2017, Rubin et al. 2018, Chazot et al. 2016).</p>
<center>
<p><img
src="https://3.bp.blogspot.com/-0ZJtpbcAlWo/W9R6ek_sNPI/AAAAAAAAUj0/ncYRT0nN9MctC-x60-boMe8bodGXNM2LQCLcBGAs/s450/ButterflyWing3a.jpg"
style="width:50.0%" /></p>
<br> <em>The anotomy of a butterfly or moth.</em>
</center>
<p><br> <br></p>
<p>Studies based on experimental manipulations like those of <span
class="citation">Jantzen and Eisner (2008)</span>, important as they
are, are limited in their ability to characterize shape variables and
the ecological roles of fore- and hind wings over evolutionary time
scales and across lepidoptera lineages. Comparative analysis of shape
data from natural history collections has helped bridge the gap between
experimental studies and macroevolutionary patterns. If there is in fact
different constraints on the evolution of fore- and hindwing morphology,
we would expect to find a consistent patterns of diffent fore- and
hindwing shape across the lepidopter. Indeed, a number of studies have
investigated whether for- and hindwing shape and size differs in several
isolated groups of butterflies. Strauss (1990) found the shape of
hindwings were much more variable than forewings in heliconiine and
ithomiine butterflies. In contrast, Chazot et al. (2016) found a strong
correlation between forewing and hindwing shapes in the famous morpho
group of butterflies. Therefore, the limited research on this topic does
not resolve whether fore- and hindwing shape differ consistently across
the Lepidoptera. Each of these studies was limited in their phylogenetic
scope, encompassing very few species spanning few families of
butterflies. Addressing whether fore- and hindwing shape varies
independently, a much broader phylogenetic sample should be analyzed,
one that includes not just representatives of the butterfly lineage, but
also moths.</p>
<center>
<p><img
src="https://d3i71xaburhd42.cloudfront.net/bb0cd297955c4ec58bd60777dc345f7c1d5d93bd/3-Figure1-1.png"
style="width:50.0%" /></p>
<br> <em>Several species of Heliconiinae butterflies, demonstrating the
variability in wingshape. From <span class="citation">Penz and Peggie
(2003)</span>.</em>
</center>
<p><br> <br></p>
<p>The goal of this project is to study wing-shape evolution across the
lepidoptera, including hundreds of species from both the moths (a
paraphyletic group) and butterflies. To do this, we’ll take a
morphometric approach, characterizing the shape outline of fore- and
hindwings from about 200 species of Lepidoptera. The specific questions
we’ll answer with our morphometric data are:</p>
<ol style="list-style-type: decimal">
<li><p>Do hind- and forewings vary in their evolutionary rates?</p></li>
<li><p>Does the evolvability of the hind- and forewings vary
significantly among major lineages of moths and butterflies?</p></li>
<li><p>Is hindwing and forewing shape correlated?</p></li>
</ol>
</div>
<div id="methods" class="section level1">
<h1>Methods</h1>
<div id="image-acquisition" class="section level2">
<h2>Image acquisition</h2>
<p>A few decades ago, a morphometric project like this would require
visiting museums collections from around the world to take images of the
specimens and species of interest. In fact, this was a major part of
Prof. Kenaley’s PhD thesis, which included trips to natural history
collections in France, Denmark, Great Britain, Taiwan, Japan, Monaco,
New Zealand, and Australia. Ahhhhhh, the gool ol’ days. Fortunately (or
unfortunately), travel to such wonderful places may be avoided as
collections have made major efforts to photograph their specimens. Now
that most museums around the world have their holdings cataloged in
databases, researchers can search their collections for records that
have images.</p>
<p>Until very recently, amassing a data set of images for morphometric
work would require querying individual databases, one at a time.
However, most natural history museums share their data with the Global
Biodiversity Information Facility (GBIF), a clearing house of
collections and species information. In the context of our project, one
could search the GBIF database online for moth and butterfly records
that have images. Fortunately for use, the folks at GBIF have created
and R package, <a
href="https://www.gbif.org/tool/81747/rgbif"><code>rgif</code></a>, that
permits access to GBIF’s application programming interface (API),
rendering their records searchable from the command line.</p>
</div>
<div id="species-list-and-phylogeny" class="section level2">
<h2>Species list and phylogeny</h2>
<p>Because we’ll be comparing wing shape across species of the
Lepidoptera, this project is by definition a comparative one and we’ll
need a phylogeny for the group. Fortunately a recent phylogenomic
analysis for 200 species of Lepidotera by <span
class="citation">Kawahara et al. (2019)</span> resolved the
relationships of the majore groups of this order. We’ve used the taxa
studied in this paper to find images in GBIF and we’ll use <a
href="lep_tree2.tre">a tree file</a> representing phylogeny for our
comparative analsyis.</p>
<center>
<p><br> <img
src="https://www.pnas.org/cms/10.1073/pnas.1907847116/asset/075c8ff7-6363-462d-a528-f2b13710804d/assets/graphic/pnas.1907847116fig01.jpeg"
style="width:50.0%" /> <br></p>
The phylogenetic relationships of the Lepidoptera according the <span
class="citation">Kawahara et al. (2019)</span>.
</center>
<p><br></p>
</div>
<div id="digitization" class="section level2">
<h2>Digitization</h2>
<p>Our shape analysis will be based on the outline of the hind- and
fore-wings of ~200 species of Lepidoptera. To outline the wings, we’ll
follow this generalize workflow below in the image analysis program FIJI
(FIJI is just imageJ).</p>
<br>
<center>
<img src="lep_workflow.jpeg" style="width:70.0%" /> <br>
</center>
<p><br></p>
<p>By now, you and your team should have been assigned about 20 of the
~200 species to outline and have accessed <a
href="https://drive.google.com/drive/folders/1NEdQ0h5KXum3DzbhCzl857R_5YxZEQq3?usp=sharing">the
directories containing their photos</a>. First choose one of your
species to work on. For each species, start with what you think is the
best image, that is, it has a scale bar, the wings are not damaged, and
the hindwing is most exposed. Open that best image in Fiji.</p>
<p>After opening the photo, follow the steps above.</p>
<ol style="list-style-type: decimal">
<li><p>If there’s a scale bar, <a
href="https://imagejdocu.list.lu/gui/analyze/set_scale">set the
scale</a>. Please set the scale in mm.</p></li>
<li><p>If the right wing pair is damaged, flip the image horizontally.
Select “Image” <span class="math inline">\(\rightarrow\)</span>
“Transform” <span class="math inline">\(\rightarrow\)</span> “Flip
horizontally”. <strong>Note:</strong> you may have to do this only for
the fore- or hindwing.</p></li>
<li><p>Select the <a
href="https://imagej.nih.gov/ij/docs/guide/146-19.html">polygon
selection tool</a>.</p></li>
<li><p>Trace the wing by placing the first point on the polygon on the
anterior margin of the wing where it meets the thorax. Like so .
.</p></li>
</ol>
<center>
<img src="firstpoint.png" style="width:40.0%" /> <br>
</center>
<p><br></p>
<p>Continue to trace the outline of the wing being sure to include
enough points to capture more complex areas. For instance, in this
swallowtail hindwing, it may require 30 or more points to outline the
interesting projections along the posterior margin.</p>
<br>
<center>
<img src="hindwing.png" style="width:40.0%" /> <br>
</center>
<p><br></p>
<p>You may also find it easier to get an acurate outline if you zoom in
(<code>crtl+</code> or <code>command+</code>).</p>
<ol start="5" style="list-style-type: decimal">
<li>Run the following macro in imageJ.</li>
</ol>
<pre><code>run(&quot;Fit Spline&quot;);
run(&quot;Properties... &quot;, &quot;list&quot;);</code></pre>
<p>This script <a
href="https://en.wikipedia.org/wiki/Spline_interpolation">fits a
spline</a> through the selected points and produces a list of the x,y
coordinates.</p>
<p><strong>Note:</strong> For the first image you outline, you will have
to open the macro editor (“Plugins” <span
class="math inline">\(\rightarrow\)</span> “New” <span
class="math inline">\(\Macro\)</span>). Paste the script command from
above into the editor and save this new macro to an appropriate
directory, perhaps you cloned repo. You’ll want to access this later
(“Plugins” <span class="math inline">\(\rightarrow\)</span> “Edit”) so
that you automate this process.</p>
<ol start="6" style="list-style-type: decimal">
<li>Save the results table that pops up and be sure to append either
“_hindwing” or “_forewing” to the file name and make sure this is before
the “.txt” file extension. <code>command+s</code> or <code>ctrl+s</code>
works.</li>
</ol>
<p>For some species there may be only one image. For others there may be
10 or more. If you can, aim to outline the wing of three specimens per
species.</p>
<p>After your team has completed outlining the assigned species, upload
your text files to <a
href="https://drive.google.com/drive/folders/1M7kb_6EooVdXZlMvkpOPSbwaRu2TfCDJ?usp=sharing">this
directory</a>. Once all the data appear here, your team can download all
the outline data.</p>
</div>
<div id="shape-analysis" class="section level2">
<h2>Shape analysis</h2>
<p>As we learned in class and you’ve been reading, researchers
interested in comparing shape change between species can use one of two
methods: landmark- or outline-base shape analysis. We’ll use the
latter.</p>
<p>Outline analysis involves breaking the shapes down into a
mathematical description of the points that constitute the shapes. The
most popular approach for fitting functions is elliptical Fourier
analysis (EFA) in which the shapes in a data set are described as a
series of ellipses. EFA attempts to align a number of ellipses to the
outline of shapes and the scale of the major and minor axes of the
ellipses are then used as the descriptor of the shapes. Of course, one
could fit a lot of ellipses and describe the shape perfectly, i.e., with
100% power; however practitioners usually stop short of this and choose
some lower lever of lower, say 99%. The number of ellipses is referred
to as the number of harmonics. In the figure below, you see the a higher
number of harmonics describe the shape in question more perfectly.</p>
<br>
<center>
<img
src="https://www.researchgate.net/profile/Ryan-Felice/publication/260448082/figure/fig4/AS:297032695730198@1447829521359/Outline-reconstruction-using-Elliptical-Fourier-Descriptors-Black-contours-represent-the.png"
style="width:60.0%" /> <br> <br> Elliptical Fourier analysis of the
pygostyle, the fused plate of caudal vertebrae that support tail
feathers in birds.
</center>
<p><br> <br></p>
<p>Once EFA is used to describe the shapes in a data set, one is left
with many variables to consider including all the descriptors of all the
ellipses that form the outlines. This could be many hundreds of
variables in a data set like ours. This is a serious <a
href="https://en.wikipedia.org/wiki/Multivariate_statistics">multivariate
problem</a>.</p>
<p>For such a problem, researchers usually turn to Principal Components
Analysis (PCA) whereby the very complicated suite of variables is
distilled into a set of fewer variables that describe the important
variance among the original variables. In a sense, PCA produces a series
of regressions, or vectors, that pass through the values of the original
variables. This operation is performed iteratively, with the first
vector (the first principal component, PC1), drawn through the variable
space that accounts for the most variance in the data set. After the
combination of variables forming PC1 is removed, a subsequent vector
(PC2) is drawn through another unique variable space that describes the
second most amount of variance. This continues until most of the
variance is captured, resulting in scores of PCs. The first two or
three, however, are usually enough to describe a health amount of
variance, say 90% or more.</p>
<p>To perform EFA and then PCA, we need only to turn to one R package,
<code>Momocs</code>. Let’s load this package and begin with an example
analysis that we can scale up on our full data set.</p>
<p><del>Let’s begin by reading in one of the outline text
files,Prof. Kenaley has already produced for 10 species of butterflies
and moths. Please <a href="lep_examples.zip">download these</a> to
follow along. You can unzip this directory and place it your project
directory.</del></p>
<p>You can begin the full analysis by <a
href="class_out_data.zip">downloading this zipped directory</a>,
unzipping it, and placing it in your project directory</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.3      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Momocs)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;Momocs&#39;
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     arrange, combine, filter, mutate, rename, sample_frac, sample_n,
##     select, slice
## 
## The following object is masked from &#39;package:tidyr&#39;:
## 
##     chop
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;class_out_data&quot;</span>,<span class="at">pattern=</span><span class="st">&quot;.txt|.csv&quot;</span>,<span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(f[<span class="dv">1</span>],<span class="at">delim=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span></code></pre></div>
<pre><code>## Rows: 223 Columns: 2
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;\t&quot;
## dbl (2): X, Y
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>out <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Out</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_flipx</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/momocexp1-1.png" width="672" /></p>
<p>Notice that we’ve found all the files in the “lep_examples” directory
with <code>list.files()</code>, searching for the patter “.txt” and
using the full filepath to make a loading the data in the directory
possible. Next, we use <code>read_delim()</code> with
<code>delim=\t</code> rather than <code>read_csc()</code> because FIJI
outputs tab-delimited data. We save this outline as <code>out</code>
after tranforming it to a matrix, the prefer format for
<code>Momocs</code>.</p>
<p>In the next operation, we transform this matrix into an
<code>Momocs</code> outline using <code>Out()</code>; however,
<code>Out()</code> must take a list of matrices and therefore we pipe in
the <code>list()</code> function first. Next, <code>coo_flipx()</code>
is invoked to flip the outline about the x axis–remember that the origin
of the image field is the upper left, not the lower left in the usual
graphical representation. Lastly, <code>stack()</code> is invoked to
visualize the outline. And here we have a forewing visualized.</p>
<p>Now, we will of course have hundreds of files to load and analyze
with PCA. For this challenge we will rely on the <del><code>for</code>
loop convention we’ve learned in projects past.</del> the
<code>vroom()</code> function in the <code>vroom</code> package. It can
read in all our data, regardless of whether the data are tab- or
comma-separated, an issue identified in class. We have the file paths
store in <code>f</code>, <del>so let’s develop this loop and store our
outline data in a list.</del>, which can be passed through this
function.</p>
<p>As was mentioned above, the <code>Out()</code> function prefers a
list, so <del>we can work on the list established here to visualize our
outlines.</del> we’ll have to construct a lits a little differently.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make a large df with vroom</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>out.df <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(f, <span class="at">id =</span> <span class="st">&quot;filename&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#make list</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>outs.l <span class="ot">&lt;-</span> <span class="fu">sapply</span>(f,<span class="cf">function</span>(x) out.df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(filename<span class="sc">==</span>x) <span class="sc">%&gt;%</span> <span class="fu">select</span>(X,Y) <span class="sc">%&gt;%</span> as.matrix)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>outs.l <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Out</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_flipx</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/datlist2-1.png" width="672" /></p>
<p>Wonderful! Fore- and hindwings loaded for the 10 examples species.
However, notice we have a few problems. First, both fore- and hindwing
are included in the in the same data set. This confounds analyzing and
comparing shape in fore- and hindwing separately, a major goal of this
project. Second, the outlines are of arbitrary size due to how much of
the pixel field they spanned in the photos and whether or not a scale in
mm was set. Thus, this arbitrary size scale would confound shape
analysis from the start. Let’s take on fixing the hindwing-forewing
issue first and, later, we’ll tackle the size issue.</p>
<p>Fortunately, we know whether each outline comes from either a fore-
or hindwing because we added these metadata to the file name. <del>Thus,
we merely need to strip this information from the file name when loading
the data in our <code>for</code> loop. Let’s do that by modified the
loop.</del> The <code>vroom()</code> function stores filename data in a
column as a way to identify data (we specified the name of this column
with <code>id =</code>filename`.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#make a large df with vroom</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>out.df <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(f, <span class="at">id =</span> <span class="st">&quot;filename&quot;</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#add wing info</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>out.df <span class="ot">&lt;-</span> out.df <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wing=</span><span class="fu">gsub</span>(<span class="st">&quot;XY_.+_(hindwing|forewing)</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>,<span class="fu">basename</span>(filename))) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#make list</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>outs.l <span class="ot">&lt;-</span> <span class="fu">sapply</span>(f,<span class="cf">function</span>(x) out.df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(filename<span class="sc">==</span>x) <span class="sc">%&gt;%</span> <span class="fu">select</span>(X,Y) <span class="sc">%&gt;%</span> as.matrix)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#extract wing info</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;XY_.+_(hindwing|forewing)</span><span class="sc">\\</span><span class="st">..+&quot;</span>,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>,<span class="fu">basename</span>(<span class="fu">names</span>(outs.l)))</span></code></pre></div>
<p>Here, we use a general regular expression function
<code>gsub()</code>, which <a
href="https://www.programmingr.com/tutorial/gsub-in-r/">finds a
character string within a fuller string</a> and replaces it. In this
case, we’ve asked <code>gsub()</code> to find either “hindwing” or
“forewing” by using “|” for the or part. We’ve also specified that these
two strings will be after any string (<code>grep</code> “.”) of any
length (<code>grep</code> “+”) and after the “_“. They’ll also appear
before”.txt”. Each wing descriptor is saved to a unique position in the
list <code>wing.l</code>.</p>
<p>To store our wing descriptors within our outlines, we can access the
<code>fac</code> option in <code>Out()</code> when transforming our list
of matrices into a list of <code>Momocs</code> outlines. This
<code>fac</code> option takes a list of named one-dimensional vectors,
so we make a list with a name “wing” that has the unlisted values of
<code>wing.l</code>. Let’s save this newly labeled list of outlines as
<code>outs</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>outs <span class="ot">&lt;-</span>  outs.l <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Out</span>(<span class="at">fac=</span><span class="fu">list</span>(<span class="at">wing=</span>wings)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_flipx</span>()</span></code></pre></div>
<p>Now we can invoke <code>Momocs</code> <code>tidy</code>-like
<code>filter()</code> function to parse the outlines according to their
wing. Let’s do that and visualize each group with
<code>stack()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>forewings <span class="ot">&lt;-</span> outs <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wing<span class="sc">==</span><span class="st">&quot;forewing&quot;</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>hindwings <span class="ot">&lt;-</span> outs <span class="sc">%&gt;%</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wing<span class="sc">==</span><span class="st">&quot;hindwing&quot;</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>forewings <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/wingfilter-1.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/wingfilter-2.png" width="672" /></p>
<p>Now that we have two lists of outlines ready for analysis, let’s come
back to our size issue. If we ran and EFA analysis on these outlines,
most of the variance would be due to their arbitrary size differences.
To address this, practitioners of shape analysis transform their shapes
into a common coordinate space that removes size altogether. The method
of choice for this is the <a
href="https://en.wikipedia.org/wiki/Procrustes_analysis">Procrustes
transformation</a>. This method superimposes the shapes by optimally
translating, rotating and uniformly scaling the objects. That is, both
the placement in space and the size of the shapes are freely adjusted so
that they are the same size and the distance between the positions of
the points constituting the shape is reduced. To align the shapes, the
can be compared to an arbitrarily selected reference shape (referred to
as ordinary Procrustes analysis) or the shapes can be aligned to an
optimally determined mean shape (referred to as generalized Procrustes
analysis). We’ll perform the latter.</p>
<p>Fortunately, <code>Momocs</code> has just a function for generalize
Procrustes superimposition, <code>fgProcrustes()</code>. Let’s use this
and visualize our results. But before we do, we must tackle another
problem: our outlines have a variable number of coordinates, making it
impossible for <code>fgProcrustes()</code> to minimize the distance
between points in each outline (which would it choose?). So we’ll just
sample 100 of the points in each outline using <code>Momocs</code>’s
<code>coo_interpolate()</code>. This function fits a spline with high
resolution to all the shapes and extracts a determined number of points
at equal intervals. We can easily find the number of coordinates in each
each set of wings and use the minimum value as the number we’ll sample
with <code>coo_interpolate()</code>. this will minimize the amount of
information we lose.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>fore.min <span class="ot">&lt;-</span> forewings <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_nb</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>forewings <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_interpolate</span>(fore.min) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/proc-1.png" width="672" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>hind.min <span class="ot">&lt;-</span> hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_nb</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_interpolate</span>(hind.min) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_slide</span>(<span class="at">id=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stack</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/proc-2.png" width="672" /></p>
<p>Now all that’s left to do is perform the EFA and then we can move on
to PC analysis. For this, all we have to do is pipe in the
<code>Momocs</code> EFA function, <code>efourier()</code>. We’ll do this
and specify <code>norm=FALSE</code> for these <a
href="https://momx.github.io/Momocs/reference/efourier.html#details">very
arcane reasons</a>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>forewings <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_interpolate</span>(fore.min) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efourier</span>(<span class="at">norm=</span><span class="cn">FALSE</span>) </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_interpolate</span>(hind.min) <span class="sc">%&gt;%</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efourier</span>(<span class="at">norm=</span><span class="cn">FALSE</span>) </span></code></pre></div>
<p>Performing the PCA is just as easy. We just finally add
<code>PCA()</code> with the pipe. We’ll have the results in
appropriately name variables.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>forewing.pca <span class="ot">&lt;-</span> forewings <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_interpolate</span>(fore.min) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coo_slide</span>(<span class="at">id=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efourier</span>(<span class="at">norm=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">PCA</span>()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>hindwing.pca <span class="ot">&lt;-</span>hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_interpolate</span>(hind.min) <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_slide</span>(<span class="at">id=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efourier</span>(<span class="at">norm=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">PCA</span>()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>hindwings <span class="sc">%&gt;%</span> </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_interpolate</span>(hind.min) <span class="sc">%&gt;%</span> </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_align</span>()  <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coo_slide</span>(<span class="at">id=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fgProcrustes</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  stack</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/PCA-1.png" width="672" /></p>
<p>We can visualize the PCA with <code>plot_PCA()</code>, which will, by
default produce a biplot of the first two PCs, the amount of variance
explained by each, and a representation of the morphoshape described by
the PCs (the outlines in the background).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>forewing.pca <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PCA</span>(<span class="at">title =</span> <span class="st">&quot;forewings&quot;</span>)</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/plotpca-1.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>hindwing.pca <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_PCA</span>(<span class="at">title =</span> <span class="st">&quot;hindwings&quot;</span>)</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/plotpca-2.png" width="672" /></p>
<p>Now we can move on to the comparative analysis.</p>
</div>
<div id="comparative-analysis" class="section level2">
<h2>Comparative analysis</h2>
<p>Before we begin, Let’s remind ourselves of the questions we’re
attempting to answer so that we can figure out exactly how to answer
then. First, do hind- and forewings vary in their evolutionary rates?
Second, do major groups of the Lepidoptera vary in their hind- and
forewing evolvability?</p>
<p>For this first question, we can simply evaluate the evolutionary rate
of our PC scores for the hind and forewings using a method of choice.
For the second question, we can look at the evolutionary rates of our PC
scores across our Lepidopteran tree.</p>
<p>First of all, as mentioned previously, we need a tree and fortunately
we have one for these species. Indeed, the species choice for this
project was based on those sampled in the <span
class="citation">Kawahara et al. (2019)</span> study. So let’s load the
tree you can <a href="lep_tree2.tre">download here</a>. Make sure it’s
in your project’s directory. We’ll use <code>read.tree()</code> from the
<code>ape</code> package and plot it just to check things out. Notice
<code>cex=0.1</code> to keep the tip labels small in the relatively
large tree.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>lep.tree <span class="ot">&lt;-</span> ape<span class="sc">::</span><span class="fu">read.tree</span>(<span class="st">&quot;lep_tree2.tre&quot;</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lep.tree,<span class="at">cex=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/tree-1.png" width="672" /></p>
<p>Looks great; however, the convention is for the root of the tree to
be positioned in the upper left. This is easy to fix with
<code>ape</code>’s <code>laddersize()</code> function. We’ll also remove
the pesky underscore between names in the tip labels. This will help
with joining the tree data with our species data.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>lep.tree <span class="ot">&lt;-</span> <span class="fu">ladderize</span>(lep.tree)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lep.tree,<span class="at">cex=</span><span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/treefix-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>lep.tree<span class="sc">$</span>tip.label <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>,<span class="st">&quot; &quot;</span>,lep.tree<span class="sc">$</span>tip.label)</span></code></pre></div>
<p>Now that we have our PCA data and a tree of species, we need to a add
species information (e.g., the species, higher taxonomic information,
etc.) to the shape data so the tree and shape data can work together.
Notice that each species is represented in the <code>outs</code> list
(from whence our PCA is derived) by the file name that belongs to its
outline. Let’s look at their names.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">basename</span>(<span class="fu">names</span>(outs))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] &quot;XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt&quot;
## [2] &quot;XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt&quot;
## [3] &quot;XY_04-SRNP-2010-DHJ331720%2B1145363716_forewing.txt&quot;                             
## [4] &quot;XY_04-SRNP-2010-DHJ331720%2B1145363716_hindwing.txt&quot;                             
## [5] &quot;XY_04-SRNP-4956-DHJ329585%2B1145303950_forewing.txt&quot;</code></pre>
<p>Not a bit of species data. However, Prof. Kenaley has stored the
filenames of each species in a table you can <a
href="lep_image_data.csv">download here</a>. Have a look.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lep.sp <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;lep_image_data.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 1106 Columns: 5
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (5): species, identifier, higher_taxon, common_name, highest_common_name
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lep.sp)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   species                      identifier                highe…¹ commo…² highe…³
##   &lt;chr&gt;                        &lt;chr&gt;                     &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 Acanthopteroctetes unifascia Acanthopteroctetes_unifa… Neopse… Archai… moths  
## 2 Acanthopteroctetes unifascia MCZ-ENT00754647_Acanthop… Neopse… Archai… moths  
## 3 Acrocercops transecta        transecta_Acrocercops_A_… Gracil… Cocoon… moths  
## 4 Actias luna                  MCZ-ENT00639291_Actias_l… Bombyc… Sphynx… moths  
## 5 Actias luna                  MCZ-ENT00639295_Actias_l… Bombyc… Sphynx… moths  
## 6 Actias luna                  UDCC_TCN_00062177_148710… Bombyc… Sphynx… moths  
## # … with abbreviated variable names ¹​higher_taxon, ²​common_name,
## #   ³​highest_common_name</code></pre>
<p>Have a look at the column “identifier”.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lep.sp<span class="sc">$</span>identifier)</span></code></pre></div>
<pre><code>## [1] &quot;Acanthopteroctetes_unifascia_M_1477601198_lg&quot;    
## [2] &quot;MCZ-ENT00754647_Acanthopteroctetes_unifascia_had&quot;
## [3] &quot;transecta_Acrocercops_A_EIHU&quot;                    
## [4] &quot;MCZ-ENT00639291_Actias_luna_had&quot;                 
## [5] &quot;MCZ-ENT00639295_Actias_luna_had&quot;                 
## [6] &quot;UDCC_TCN_00062177_1487105077_lg&quot;</code></pre>
<p>This is the vector of the image file names minus the extension (.jpg,
.png, etc.). Notice that our outline names, rather than species, contain
this information~~you saved the FIJI results as
“XY_filename_hingwing.txt” or “XY_filename_forewing.txt”. That is, this
very same identifier in the species table is buried in the names of our
outline data. So let’s make a new tibble that strips the same identifier
from the outline names and join the species data to this new tibble.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>out.data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">xy.file=</span><span class="fu">basename</span>(<span class="fu">names</span>(outs))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">identifier=</span><span class="fu">gsub</span>(<span class="st">&quot;XY_|_hindwing|_forewing|.txt&quot;</span>,<span class="st">&quot;&quot;</span>,xy.file)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lep.sp)</span></code></pre></div>
<pre><code>## Joining, by = &quot;identifier&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(out.data)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   xy.file                                ident…¹ species highe…² commo…³ highe…⁴
##   &lt;chr&gt;                                  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
## 1 XY_001FE051A037367D9317121CD75AD95860… 001FE0… Operop… Geomet… Geomet… moths  
## 2 XY_001FE051A037367D9317121CD75AD95860… 001FE0… Operop… Geomet… Geomet… moths  
## 3 XY_04-SRNP-2010-DHJ331720%2B114536371… 04-SRN… Macros… Papili… Papili… butter…
## 4 XY_04-SRNP-2010-DHJ331720%2B114536371… 04-SRN… Macros… Papili… Papili… butter…
## 5 XY_04-SRNP-2010-DHJ331720%2B114536371… 04-SRN… Macros… Papili… Papili… butter…
## 6 XY_04-SRNP-2010-DHJ331720%2B114536371… 04-SRN… Macros… Papili… Papili… butter…
## # … with abbreviated variable names ¹​identifier, ²​higher_taxon, ³​common_name,
## #   ⁴​highest_common_name</code></pre>
<p>With this tibble in place, we can now add species information to our
PCA data. The PC scores are store in the the variable <code>x</code>, so
we can summon them this way. Notice that the row names correspond to the
outline file names, a column in out <code>out.data</code> tibble.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hindwing.pca<span class="sc">$</span>x,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                                                                                                         PC1
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.001596854
##                                                                                                         PC2
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.01065942
##                                                                                                         PC3
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.01016774
##                                                                                                          PC4
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0006281855
##                                                                                                          PC5
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0006990538
##                                                                                                           PC6
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0006872751
##                                                                                                          PC7
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0003017221
##                                                                                                          PC8
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 6.419525e-05
##                                                                                                          PC9
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0007174265
##                                                                                                        PC10
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.000520921
##                                                                                                         PC11
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0002173181
##                                                                                                          PC12
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0002710831
##                                                                                                        PC13
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.000274409
##                                                                                                          PC14
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0005467508
##                                                                                                          PC15
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0003644627
##                                                                                                          PC16
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0002883262
##                                                                                                         PC17
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0001656368
##                                                                                                         PC18
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0001404656
##                                                                                                          PC19
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -2.733145e-06
##                                                                                                          PC20
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0002177258
##                                                                                                          PC21
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -0.0002981619
##                                                                                                         PC22
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0002471451
##                                                                                                         PC23
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 1.390762e-05
##                                                                                                        PC24
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.000236569
##                                                                                                         PC25
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0001326966
##                                                                                                         PC26
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 0.0001817011
##                                                                                                          PC27
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -4.887553e-05
##                                                                                                         PC28
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -1.86995e-05
##                                                                                                         PC29
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 2.142911e-05
##                                                                                                          PC30
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -4.070668e-05
##                                                                                                         PC31
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt 5.941335e-06
##                                                                                                          PC32
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_hindwing.txt -4.768948e-06</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(forewing.pca<span class="sc">$</span>x,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##                                                                                                         PC1
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.01025223
##                                                                                                         PC2
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.004240181
##                                                                                                         PC3
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.004870515
##                                                                                                          PC4
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.004225145
##                                                                                                         PC5
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.001930387
##                                                                                                         PC6
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.002224481
##                                                                                                          PC7
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.000577065
##                                                                                                         PC8
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.000201347
##                                                                                                           PC9
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -3.961416e-05
##                                                                                                         PC10
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.000778136
##                                                                                                         PC11
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.001159634
##                                                                                                         PC12
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.000505002
##                                                                                                         PC13
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 4.284186e-05
##                                                                                                        PC14
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.001000832
##                                                                                                         PC15
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.0007192053
##                                                                                                          PC16
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.0001428947
##                                                                                                          PC17
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.0007602974
##                                                                                                         PC18
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 4.795405e-05
##                                                                                                          PC19
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.0001025974
##                                                                                                          PC20
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -0.0004022935
##                                                                                                         PC21
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.0001255189
##                                                                                                         PC22
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.0004056201
##                                                                                                         PC23
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 4.981218e-05
##                                                                                                         PC24
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 1.781731e-05
##                                                                                                         PC25
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 0.0001725023
##                                                                                                         PC26
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 2.199328e-05
##                                                                                                         PC27
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt 5.539934e-05
##                                                                                                          PC28
## class_out_data/XY_001FE051A037367D9317121CD75AD958605A968812F4D791E7AC11800052DEBC_forewing.txt -8.151747e-06</code></pre>
<p>Let’s now join the species information in our <code>out.data</code>
tibble to the PCA data, storing these in new variables.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>hindwing.pca2 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">xy.file=</span><span class="fu">basename</span>(<span class="fu">rownames</span>(hindwing.pca<span class="sc">$</span>x)),<span class="at">PC1=</span>hindwing.pca<span class="sc">$</span>x[,<span class="dv">1</span>],<span class="at">PC2=</span>hindwing.pca<span class="sc">$</span>x[,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(out.data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;xy.file&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>forewing.pca2 <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">xy.file=</span><span class="fu">basename</span>(<span class="fu">rownames</span>(forewing.pca<span class="sc">$</span>x)),<span class="at">PC1=</span>forewing.pca<span class="sc">$</span>x[,<span class="dv">1</span>],<span class="at">PC2=</span>forewing.pca<span class="sc">$</span>x[,<span class="dv">2</span>])<span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(out.data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;xy.file&quot;</code></pre>
<p>Now we have the first 2 PCs for each wing stored with species
information and are now ready for comparative analysis.</p>
</div>
<div id="evolutionary-rates" class="section level2">
<h2>Evolutionary rates</h2>
<p>There are several methods available to comparative biologist to
estimate the rates of morphological evolution over a phylogenetic tree.
We’ll be using <span class="citation">O’Meara et al. (2006)</span>’s
method, the so-called “noncensored test” which uses the entire
varian-cecovariance matrix (established by the a phylogeny) to calculate
the likelihood of rates accross the tree. In this approach, one
ancestral state is estimated under Brownian motion for the entire tree
and the the optimal rate parameter values are estimated numerically
until the likelihood of the model is maximized. This method is captured
in the R package <code>phytools</code> with the function
<code>brownie.lite()</code>.</p>
<p><code>brownie.lite()</code> takes two important arguments, a tree and
the phenotypic values for each tip in the tree. Let’s take our tree and
drop any tips that don’t occur in our PCA data.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>drops <span class="ot">&lt;-</span> lep.tree<span class="sc">$</span>tip.label[<span class="sc">!</span>lep.tree<span class="sc">$</span>tip.label<span class="sc">%in%</span><span class="fu">unique</span>(out.data<span class="sc">$</span>species)]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>lep.tree2 <span class="ot">&lt;-</span> <span class="fu">drop.tip</span>(lep.tree,drops)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lep.tree2,<span class="at">cex=</span><span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/tree2-1.png" width="672" /></p>
<p>Here we only include <code>lep.tree</code> tip labels that are in the
unique species values of our <code>out.data</code> variable. Then we use
<code>ape</code>’s <code>drop.tip()</code> function to drop the tips in
our tree that don’t occur in our <code>out.data</code> tibble.</p>
<p>The phenotypic data passed to the <code>x</code> argument must be a
named vector of values, so let’s establish that for PCs 1 and 2, for
both the hind- and forewings.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#PC1s</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>hind.pc1 <span class="ot">&lt;-</span> hindwing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC1=</span><span class="fu">mean</span>(PC1)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  pull</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hind.pc1) <span class="ot">&lt;-</span>  hindwing.pca2<span class="sc">%&gt;%</span> </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC1=</span><span class="fu">mean</span>(PC1)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(species)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>fore.pc1 <span class="ot">&lt;-</span> forewing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC1=</span><span class="fu">mean</span>(PC1)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(PC1)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fore.pc1) <span class="ot">&lt;-</span>  forewing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC1=</span><span class="fu">mean</span>(PC1)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(species)</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">#PC2s</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>hind.pc2 <span class="ot">&lt;-</span> hindwing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC2=</span><span class="fu">mean</span>(PC2)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(PC2)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hind.pc2) <span class="ot">&lt;-</span>  hindwing.pca2<span class="sc">%&gt;%</span> </span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC2=</span><span class="fu">mean</span>(PC2)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(species)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>fore.pc2 <span class="ot">&lt;-</span> forewing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC2=</span><span class="fu">mean</span>(PC2)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(PC2)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(fore.pc2) <span class="ot">&lt;-</span>  forewing.pca2 <span class="sc">%&gt;%</span> </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species<span class="sc">%in%</span> lep.tree2<span class="sc">$</span>tip.label) <span class="sc">%&gt;%</span> </span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb44-48"><a href="#cb44-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PC2=</span><span class="fu">mean</span>(PC2)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-49"><a href="#cb44-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(species)</span></code></pre></div>
<p>Notice here that we filtered the PCA data to include only species
that occur in our new, pruned tree. That is, tree species may be in the
the PCA data, but species in the PCA data may not be in the tree. This
is because some species queried in GBIF were returned as <a
href="https://en.wikipedia.org/wiki/Synonym_(taxonomy)">synonyms</a>
under different valid taxonomic names. We won’t worry about this now
except to exclude these species as we have above and forge ahead.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phytools)</span></code></pre></div>
<pre><code>## Loading required package: maps</code></pre>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>forePC1.BM<span class="ot">&lt;-</span><span class="fu">brownie.lite</span>(lep.tree2,fore.pc1<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>hindPC1.BM<span class="ot">&lt;-</span><span class="fu">brownie.lite</span>(lep.tree2,hind.pc1<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>forePC2.BM<span class="ot">&lt;-</span><span class="fu">brownie.lite</span>(lep.tree2,fore.pc2<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>hindPC2.BM<span class="ot">&lt;-</span><span class="fu">brownie.lite</span>(lep.tree2,hind.pc2<span class="sc">*</span><span class="dv">10</span>)</span></code></pre></div>
<p>Also notice here that we multiplied our tip values by an arbitrary 10
units. This is because this <a
href="http://blog.phytools.org/2011/12/error-message-from-brownielite-and.html">algorithm
stumbles</a> when tip branches are short and tip values are small.
Great, now we have evolutionary rate estimates of wing shape store in
each variable under <code>sig2.single</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>forePC1.BM<span class="sc">$</span>sig2.single</span></code></pre></div>
<pre><code>## [1] 0.006535527</code></pre>
<p>With these values stored we can compare the evolutionary rate for the
first and second PCs between fore- and hindwings, something you should
do in your report.</p>
</div>
<div id="shifts-in-evolutionary-rates" class="section level2">
<h2>Shifts in evolutionary rates</h2>
<p>We are also seeking to answer whether major groups of the Lepidoptera
have undergone significant changes in the rate of wing-shape evolution.
<code>brownie.lite()</code> can do this, but this method tells the
practitioner nothing about the sign of the rate shife, i.e, whether the
shift was to a slower or faster rate. For this, we’ll use another
method, phylogenetic ridge regression <span class="citation">(Kratsch
and McHardy 2014)</span>. This approach takes a tree and a vector of tip
data phenotypes, calculates the ancestral states at each node in the
tree, and produces a regression line through each path in the tree, from
root to tip including from each deeper node to a daugter node. The
regressions are based on the phenotype values at each node vs. time
between nodes and along path. The value of the slope parameter of these
regressions is the rate. From this, we have rate vectors, i.e, changes
in rate.</p>
<p>To implement ridge regression, we’ll turn to the <code>RRphylo</code>
package written by <span class="citation">Castiglione et al.
(2018)</span>. Like, <code>brownie.lite()</code> the function
<code>RRphylo()</code> takes a tree and tip data as argurment. For
instance, here we compute the rates along the branches for hingwing
PC1.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RRphylo)</span></code></pre></div>
<pre><code>## Loading required package: emmeans</code></pre>
<pre><code>## 
## Attaching package: &#39;RRphylo&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:phytools&#39;:
## 
##     node.paths</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>hindPC1.RR <span class="ot">&lt;-</span> <span class="fu">RRphylo</span>(<span class="at">tree=</span>lep.tree2,<span class="at">y=</span>hind.pc1)</span></code></pre></div>
<p>The output of <code>RRphylo()</code> is massive, including the rates
computed for each branch in the tree.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>hindPC1.RR<span class="sc">$</span>rates</span></code></pre></div>
<pre><code>##                                           [,1]
## 169                              -7.218146e-03
## 170                              -1.066973e-03
## 171                              -2.049241e-03
## 172                              -1.868246e-03
## 173                              -8.883381e-04
## 174                              -5.871552e-04
## 175                               3.274117e-04
## 176                               7.299944e-04
## 177                               1.216982e-03
## 178                               1.811540e-03
## 179                               5.323251e-03
## 180                               3.416703e-03
## 181                               2.265231e-03
## 182                               4.986508e-03
## 183                               8.769382e-03
## 184                               3.316374e-03
## 185                               4.224790e-03
## 186                               5.199821e-03
## 187                              -4.715654e-05
## 188                               2.185907e-03
## 189                               3.495490e-03
## 190                               2.411409e-03
## 191                               1.653206e-03
## 192                               1.357457e-03
## 193                               1.033888e-03
## 194                               8.472677e-04
## 195                               4.041844e-05
## 196                              -2.076112e-04
## 197                              -7.599750e-04
## 198                              -8.400525e-03
## 199                              -3.038502e-03
## 200                              -2.944994e-03
## 201                              -2.573937e-04
## 202                              -8.165846e-04
## 203                              -3.097791e-04
## 204                              -1.889357e-04
## 205                              -8.695679e-04
## 206                              -3.741443e-04
## 207                               2.758212e-04
## 208                               4.473551e-03
## 209                               2.638193e-03
## 210                               4.476567e-04
## 211                               2.604635e-03
## 212                               1.942551e-03
## 213                               1.423674e-03
## 214                               2.150457e-03
## 215                               6.917210e-04
## 216                               1.945852e-03
## 217                               1.429194e-03
## 218                               2.753871e-03
## 219                               2.854274e-03
## 220                               2.469535e-03
## 221                               8.160083e-04
## 222                               2.178969e-03
## 223                               8.851624e-05
## 224                               1.860713e-03
## 225                               1.306245e-03
## 226                               6.495698e-04
## 227                               6.524829e-04
## 228                               2.233952e-03
## 229                               8.968380e-04
## 230                               2.581296e-04
## 231                              -1.129973e-04
## 232                              -1.485095e-04
## 233                               2.192372e-03
## 234                               1.133083e-03
## 235                               8.666131e-05
## 236                              -8.545768e-04
## 237                              -4.802642e-04
## 238                              -2.375331e-03
## 239                              -8.601150e-06
## 240                              -2.210968e-03
## 241                               6.330462e-04
## 242                               9.807078e-04
## 243                               7.045941e-04
## 244                               5.111802e-04
## 245                               2.744438e-04
## 246                               5.902316e-04
## 247                               4.601826e-05
## 248                               6.091737e-03
## 249                              -2.510788e-03
## 250                              -3.264746e-03
## 251                              -1.837068e-03
## 252                               1.549076e-03
## 253                              -9.963654e-04
## 254                              -2.364928e-03
## 255                              -4.570848e-04
## 256                              -1.897925e-03
## 257                              -2.517318e-03
## 258                              -2.352536e-03
## 259                              -8.569724e-04
## 260                               5.638086e-04
## 261                               1.201584e-03
## 262                              -6.978527e-05
## 263                              -3.411225e-03
## 264                              -8.812424e-03
## 265                              -6.748145e-03
## 266                              -3.820953e-03
## 267                              -2.364109e-03
## 268                              -2.473500e-03
## 269                              -4.985156e-03
## 270                               1.454713e-02
## 271                               7.927653e-03
## 272                               8.415523e-03
## 273                               5.062255e-03
## 274                               5.014689e-03
## 275                               2.737458e-03
## 276                               2.466309e-03
## 277                               4.331238e-03
## 278                               1.310522e-03
## 279                               6.043210e-03
## 280                               1.399618e-03
## 281                               3.183069e-03
## 282                               2.814125e-03
## 283                               7.009958e-04
## 284                               6.665861e-05
## 285                               2.688400e-03
## 286                               1.036792e-02
## 287                               2.548716e-03
## 288                               6.797352e-04
## 289                               3.211613e-03
## 290                               1.794768e-03
## 291                               1.344176e-02
## 292                               5.965575e-04
## 293                               8.704154e-03
## 294                               1.832535e-03
## 295                               3.024029e-03
## 296                              -2.685142e-03
## 297                              -7.926913e-04
## 298                              -1.819024e-04
## 299                               2.770570e-04
## 300                               3.542448e-04
## 301                              -1.574961e-02
## 302                              -3.318072e-03
## 303                              -8.371185e-04
## 304                              -5.906063e-04
## 305                              -1.456842e-03
## 306                              -6.765524e-03
## 307                              -2.192212e-04
## 308                              -2.410487e-04
## 309                              -9.667303e-04
## 310                              -6.046164e-03
## 311                              -7.654621e-04
## 312                              -6.925192e-03
## 313                              -3.082618e-03
## 314                              -3.862689e-03
## 315                              -1.443530e-03
## 316                              -2.491090e-03
## 317                              -2.138109e-03
## 318                              -7.651193e-04
## 319                              -2.357808e-03
## 320                              -5.947031e-03
## 321                              -4.676117e-03
## 322                              -7.051707e-03
## 323                              -8.154415e-04
## 324                              -1.240022e-03
## 325                              -1.746973e-03
## 326                              -1.203692e-03
## 327                              -7.563293e-03
## 328                              -2.988840e-05
## 329                               7.773877e-04
## 330                              -1.018278e-02
## 331                              -2.889314e-03
## 332                              -2.008492e-03
## 333                              -2.394712e-03
## 334                              -4.472649e-03
## 335                              -2.596307e-03
## Ceratomia undulosa               -4.771064e-04
## Sphinx pinastri                  -7.424314e-04
## Manduca sexta                    -1.400546e-03
## Smerinthus saliceti              -1.182805e-03
## Parum colligata                  -1.177787e-03
## Adhemarius daphne                -2.469154e-03
## Hyles euphorbiae                 -6.158681e-04
## Darapsa myron                    -1.127010e-03
## Macroglossum pyrrhosticta        -8.838111e-04
## Enyo lugubris                     2.206956e-03
## Hemaris diffinis                  8.260136e-04
## Saturnia pyri                     1.478076e-03
## Actias luna                       1.489394e-03
## Hemileuca maia                   -3.235083e-04
## Eacles sp                         2.249139e-03
## Bombyx mori                       3.798773e-03
## Colla sp                          2.148102e-03
## Mustilizans dierli                4.473833e-03
## Eupterote muluana                 2.001264e-03
## Ganisa similis                    1.752661e-03
## Brahmaea hearseyi                 4.060827e-03
## Apatelodes pithala                1.875124e-03
## Artace sp                         4.752630e-04
## Dendrolimus pini                  1.041802e-03
## Ectropis obliqua                  1.364656e-03
## Biston betularia                  1.229407e-03
## Macaria distribuaria              2.337533e-03
## Nemoria lixaria                   9.689075e-04
## Chlorosea margaretaria            2.978931e-04
## Idaea sp                          9.390413e-04
## Operophtera brumata              -2.748923e-04
## Lyssa zampa                       4.726893e-03
## Calledapteryx dryopterata         1.054608e-03
## Epicopeia hainseii               -6.906667e-04
## Striacosta albicosta              1.952336e-04
## Sesamia inferens                 -1.301285e-03
## Mythimna separata                 9.359277e-04
## Spodoptera exigua                 4.452741e-04
## Spodoptera frugiperda             5.139846e-04
## Heliothis virescens               1.858567e-04
## Helicoverpa zea                   1.810962e-04
## Amphipyra pyramidea               2.560387e-04
## Manoba major                      2.031410e-03
## Anigraea sp                      -1.447899e-03
## Phragmatobia fuliginosa          -3.426718e-05
## Melese sp                        -1.237014e-05
## Amata phegea                     -1.341498e-03
## Auriculoceryx pterodactyliformis -2.295788e-03
## Phyllodes eyndhovii               3.462296e-04
## Eudocima salaminia                1.470462e-03
## Lymantria dispar                  1.516320e-03
## Euproctis chrysorrhoea            3.967913e-04
## Pheosia gnoma                     2.214555e-04
## Notoplusia minuta                 9.875676e-04
## Pseudothyatira cymatophoroides   -1.455110e-03
## Cyclidia substigmaria             1.839567e-03
## Macrauzata submontana             4.938975e-03
## Doa sp                           -2.496548e-03
## Axia margarita                    3.739494e-03
## Lacosoma chiridota                1.326875e-03
## Menevia lantona                   1.513427e-03
## Catoptria falsella                3.548528e-05
## Catoptria oregonicus              5.073830e-04
## Myelobia sp                      -2.807755e-03
## Chilo suppressalis               -6.963671e-04
## Cnaphalocrocis medinalis         -1.177574e-03
## Spilomela sp                     -7.073393e-04
## Cirrhochrista sp                 -2.624869e-03
## Amyelois transitella             -6.201594e-04
## Plodia interpunctella            -1.533135e-03
## Galleria melonella               -2.146492e-03
## Striglina suzukii                 2.085433e-03
## Pseudothyris sepulchralis        -2.564647e-03
## Canaea sp                         3.008366e-03
## Pterodecta felderi                4.233110e-03
## Emmelina monodactyla             -5.211335e-03
## Pterophorus pentadactyla         -3.444297e-03
## Lantanophaga pusillidactyla      -8.641895e-03
## Alucita desmodactyla              6.836706e-03
## Autosticha sp                    -5.312883e-03
## Hyposmocoma kahamanoa            -6.168345e-03
## Dichomeris punctidiscella        -5.488243e-03
## Psilocorsis reflexella           -4.989901e-03
## Antaeotricha schlaegeri          -1.248406e-03
## Melitaea cinxia                   2.164878e-03
## Junonia coenia                    2.549130e-03
## Polygonia c-album                 3.585875e-03
## Heliconius melpomene              1.106819e-03
## Bicyclus anynana                  2.688570e-03
## Pararge aegeria                   1.351422e-03
## Maniola jurtina                   2.439992e-03
## Danaus plexippus                  3.445879e-03
## Hemiargus ceraunus                1.326241e-04
## Polyommatus icarus               -9.404999e-05
## Calycopis cecrops                 1.589735e-03
## Cigaritis takanonis               5.365007e-03
## Mycastor nealces                  1.634851e-03
## Semomesia capanea                 2.755938e-03
## Anthocharis cardamines            7.206239e-04
## Hebomoia glaucippe                2.593403e-03
## Ascia monuste                     2.245220e-03
## Phoebis sennae                    3.008238e-03
## Colias croceus                    1.103444e-03
## Lerema accius                     1.651216e-03
## Hylephila phyleus                 2.070199e-03
## Megathymus yuccae                 2.109715e-03
## Macrosoma sp                     -1.104618e-03
## Papilio machaon                   1.423561e-03
## Papilio glaucus                   1.521618e-03
## Parides eurimedes                 1.569950e-03
## Luehdorfia chinensis              3.858012e-03
## Dalcera abrasa                    1.362037e-03
## Demonarosa rufotessellata         8.130242e-04
## Megalopyge crispata               1.238360e-03
## Lactura subfervens               -5.377281e-03
## Bembecia ichneumoniformis        -1.596536e-03
## Podosesia syringae               -1.470933e-03
## Synemon plana                    -2.138630e-03
## Archaeoses polygrapha            -5.463678e-03
## Morpheis pyracmon                -1.820337e-03
## Psychonoctua personalis          -1.687984e-03
## Givira mucida                    -3.769288e-03
## Prionoxystus robiniae            -1.255163e-03
## Culama sp                         1.909302e-04
## Spinulata maruga                 -2.637970e-03
## Grapholita dimorpha              -2.123306e-04
## Cydia pomonella                  -7.599648e-04
## Phaecasiophora niveiguttana      -1.340250e-03
## Imma tetrascia                   -3.524034e-04
## Hemerophila diva                  5.330541e-03
## Acrocercops transecta            -8.484656e-03
## Phyllocnistis citrella           -5.058443e-03
## Cameraria ohridella              -3.827076e-03
## Caloptilia triadicae             -8.003485e-03
## Bucculatrix cristatella          -6.868977e-03
## Leucoptera coffeella             -5.301066e-03
## Plutella xylostella              -7.970090e-03
## Amphithera heteroleuca           -8.759750e-04
## Harmaclona sp                    -9.851437e-03
## Dryadaula visaliella             -8.289382e-03
## Thyridopteryx ephemeraeformis     4.964137e-03
## Eudarcia simulatricella          -8.400212e-03
## Palaephatus nielseni             -3.214003e-03
## Palaephatus luteolus             -2.425350e-03
## Ptyssoptera sp                   -3.861987e-03
## Metaphatus ochraceus             -2.241816e-03
## Coptotriche citrinipennella      -6.550403e-03
## Nemophora degeerella             -6.252817e-03
## Andesiana lamellata              -3.613399e-03
## Enteucha acetosae                -1.863751e-03
## Stigmella atricapitella          -6.250049e-04
## Pseudopostega cf.quadristrigella -1.508060e-04
## Phymatopus californicus          -8.428927e-04
## Cibyra sp                        -7.740902e-04
## Lophocorona astipica             -5.543010e-03
## Acanthopteroctetes unifascia      7.583836e-03
## Neopseustis meyricki             -5.603830e-04
## Dyseriocrania subpurpurella      -8.106561e-03
## Heterobathmia sp                 -6.854152e-03
## Agathiphaga queenslandensis      -7.740123e-03
## Micropterix calthella            -5.524800e-03
## Stenopsychodes sp                -5.228333e-03
## Philopotamus NA                  -3.801100e-03
## Arctopsyche palpata              -2.767250e-03
## Helicopsyche borealis            -7.139471e-03
## Nectopsyche candida              -3.276671e-03
## Ptilostomis semifasciata         -4.937043e-04
## Palaeagapetus nearcticus         -8.264057e-04</code></pre>
<p>Because we’re interested in rate shifts, we use the rates from
<code>RRphylo()</code> to tests whether individual clades evolve at
different rates as compared to the rest of the tree. This is performed
with <code>RRphylo</code>’s <code>search.shift()</code>. Here we specify
that we want to know if any clades/lineages have exceptional rate shifts
with <code>status.type="clade"</code>. The singles clades with exception
shifts are stored in <code>single.clade</code>, only the p value of the
shift. Large rates are significantly larger than the rest of the tree
(at alpha = 0.05), when the probability is &gt; 0.975; and small rates
are significantly small for p &lt; 0.025.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>hindPC1.SS<span class="ot">&lt;-</span> <span class="fu">search.shift</span>(<span class="at">RR=</span>hindPC1.RR,<span class="at">status.type=</span><span class="st">&quot;clade&quot;</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>hindPC1.SS<span class="sc">$</span>single.clades</span></code></pre></div>
<pre><code>##     rate.difference p.value
## 225    -0.001940948   0.001</code></pre>
<p>With this information we could visualize the nodes with exceptional
shifts using <code>ape</code>’s <code>nodelabels</code> function. We
merely need to plot the tree and take the numeric values of the row
names returned in <code>single.clades</code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lep.tree2)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nodelabels</span>(<span class="at">node =</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(hindPC1.SS<span class="sc">$</span>single.clades)),<span class="at">text =</span> <span class="fu">rownames</span>(hindPC1.SS<span class="sc">$</span>single.clades))</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/viznodes-1.png" width="672" /></p>
<p>This is fine, but <code>RRphylo</code>’s <code>plotShift()</code>
does this for us. It’s a little odd, but this function stores a plot in
<code>plotClades()</code>, rather than produce a plot.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>hindPC1.plot <span class="ot">&lt;-</span> <span class="fu">plotShift</span>(<span class="at">RR=</span>hindPC1.RR,<span class="at">SS=</span>hindPC1.SS)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>forePC1.plot <span class="ot">&lt;-</span> <span class="fu">plotShift</span>(<span class="at">RR=</span>hindPC1.RR,<span class="at">SS=</span>hindPC1.SS)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>hindPC1.plot<span class="sc">$</span><span class="fu">plotClades</span>()</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/plotshifts-1.png" width="672" /></p>
<p>From the <code>single.clades</code> output and the tree labeled with
<code>nodelabels</code>, we see that clade 36 represents a signifcant
slow down, shifting -0.0034 units, but in clade 33 there’s a signifant
increase of 0.0053 units.</p>
<p>Seems we’ve answer part of the question at least as it pertains to
hindwing PC1 and our limited sample of species, “Have there been shifts
in wing shape evolution in Lepidopteran lineages?” But, which lineage
have shifted? We know which species belong to these lineages, but not
the lineage name.</p>
<p>To extract this information and view it on the tree, let’s use a
custom function, one written by Prof. Kenaley. For this, we’ll need
<code>ggtree</code>, a tree annotation package written to work with
trees like <code>ggplot2</code> works with data and standard plots.
We’ll have to download <code>ggtree</code> rom the
<code>Bioconductor</code> repository, another place where packages are
stored, much like <code>CRAN</code>. To do this, run the following only
<strong>ONCE</strong>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">&quot;BiocManager&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">&quot;BiocManager&quot;</span>)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">&quot;ggtree&quot;</span>)</span></code></pre></div>
<p>We’ll also need the <code>wesanderson</code> package for nice colors
which can be downloaded from <code>CRAN</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtree)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wesanderson)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>plot_SS <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">tre=</span><span class="cn">NULL</span>,<span class="at">SS=</span><span class="cn">NULL</span>,<span class="at">tax=</span><span class="cn">NULL</span>){</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  nodes <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">rownames</span>(SS<span class="sc">$</span>single.clades))</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  pal <span class="ot">&lt;-</span> <span class="fu">wes_palette</span>(<span class="st">&quot;Zissou1&quot;</span>,<span class="at">n=</span><span class="fu">length</span>(nodes))</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  sp <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> nodes){</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>    sp.i <span class="ot">&lt;-</span> <span class="fu">extract.clade</span>(tre,i)<span class="sc">$</span>tip.label</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(head(tax))</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>    sub.names <span class="ot">&lt;-</span> <span class="fu">lapply</span>(tax,<span class="cf">function</span>(x) x[x<span class="sc">%in%</span>sp.i]) </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>    in.clades <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sub.names,<span class="cf">function</span>(x) <span class="fu">length</span>(x)<span class="sc">&gt;</span><span class="dv">0</span>) </span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>    all.of.clade <span class="ot">&lt;-</span> <span class="fu">lapply</span>(sub.names,<span class="cf">function</span>(x) <span class="fu">all</span>(<span class="fu">sapply</span>(sp.i,<span class="cf">function</span>(z) z<span class="sc">%in%</span>x))) </span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    high.clade <span class="ot">&lt;-</span> <span class="fu">names</span>(sub.names)[<span class="fu">last</span>(<span class="fu">which</span>(all.of.clade<span class="sc">==</span>T))]</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>    all.clades <span class="ot">&lt;-</span> <span class="fu">names</span>(sub.names)[<span class="fu">which</span>(in.clades<span class="sc">==</span>T)]</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    crown <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(high.clade<span class="sc">!=</span><span class="fu">last</span>(<span class="fu">names</span>(sub.names))) crown <span class="ot">&lt;-</span> <span class="st">&quot;crown-&quot;</span></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    sub.clades <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">grepl</span>(<span class="st">&quot;oidea&quot;</span>,all.clades))<span class="sc">&gt;</span><span class="dv">0</span>) sub.clades <span class="ot">&lt;-</span> all.clades[<span class="fu">grepl</span>(<span class="st">&quot;oidea&quot;</span>,all.clades)]</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    high.clade2 <span class="ot">&lt;-</span> <span class="fu">paste0</span>(crown,high.clade,<span class="st">&quot;: &quot;</span>,<span class="fu">paste0</span>(sub.clades,<span class="at">collapse =</span> <span class="st">&quot;+&quot;</span>))</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    sp[[<span class="fu">paste0</span>(i)]] <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">n=</span>i,<span class="at">species=</span>sp.i,<span class="at">clade=</span>high.clade2)</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind,sp)<span class="sc">%&gt;%</span> </span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">label=</span>species) </span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  d2<span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">clade_name=</span>clade) </span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggtree</span>(tre)<span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  p<span class="sc">$</span>data <span class="ot">&lt;-</span> p<span class="sc">$</span>data <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(d) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(<span class="fu">tibble</span>(<span class="at">node=</span>nodes,SS<span class="sc">$</span>single.clades) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">shift=</span><span class="fu">ifelse</span>(rate.difference<span class="sc">&gt;</span><span class="dv">0</span>,<span class="st">&quot;+&quot;</span>,<span class="st">&quot;-&quot;</span>)))</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span>  p<span class="sc">+</span><span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">col=</span>clade),<span class="at">geom=</span><span class="st">&quot;text&quot;</span>,<span class="at">size=</span><span class="fl">1.2</span>)<span class="sc">+</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_cladelab</span>(<span class="at">data=</span>d2,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">node=</span>n,<span class="at">col=</span>clade_name,<span class="at">label=</span>clade_name),<span class="at">offset=</span><span class="dv">1</span>,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hilight</span>(<span class="at">data=</span>d2,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">node =</span> n,<span class="at">fill=</span>clade_name),<span class="at">alpha =</span> <span class="fl">0.01</span>)<span class="sc">+</span></span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal)<span class="sc">+</span></span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal)<span class="sc">+</span></span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span><span class="fu">geom_nodepoint</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">subset =</span> shift <span class="sc">==</span><span class="st">&quot;-&quot;</span>), <span class="at">size=</span><span class="dv">5</span>, <span class="at">shape=</span><span class="dv">25</span>,<span class="at">fill=</span><span class="st">&#39;blue&#39;</span>,<span class="at">color=</span><span class="st">&#39;blue&#39;</span>,<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_nodepoint</span>(<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">subset =</span> shift <span class="sc">==</span><span class="st">&quot;+&quot;</span>), <span class="at">size=</span><span class="dv">5</span>, <span class="at">shape=</span><span class="dv">24</span>, <span class="at">fill=</span><span class="st">&#39;red&#39;</span>,<span class="at">color=</span><span class="st">&#39;red&#39;</span>,<span class="at">alpha=</span><span class="fl">0.7</span>)</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p<span class="sc">+</span><span class="fu">xlim</span>(<span class="cn">NA</span>,<span class="dv">6</span>)</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">n=</span>nodes,SS<span class="sc">$</span>single.clades) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(d <span class="sc">%&gt;%</span> <span class="fu">select</span>(n,clade) <span class="sc">%&gt;%</span> unique)</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">plot=</span>p,<span class="at">res=</span>res))</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This custom function <code>plot_SS()</code> takes three arguments,
<code>tre</code> (a tree variable of class <code>phy</code>),
<code>SS</code> (output from <code>search.shift()</code>), and
<code>tax</code> (a <del>tibble/data.frame</del> a list, containing
<del>the column <code>species</code> and
<code>higher_taxon</code>)</del> clade/lineage names and their species.
<del>We have the higher taxon names stored in our PCA tibbles
(<code>hindwing.pca2</code>, etc.)</del>. Please load the taxon name
list by downloading <a href="Lep_classification.RDS">this R data
file</a>.</p>
<p>The function returns a plot under <code>$plot</code> and the
<code>search.shift()</code> results under <code>$res</code>.</p>
<p>Let’s try it out by first loading the taxon names with
<code>readRDS()</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>tax.names <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Lep_classification.RDS&quot;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>hindPC1.res <span class="ot">&lt;-</span> <span class="fu">plot_SS</span>(lep.tree2,hindPC1.SS,<span class="at">tax =</span> tax.names)</span></code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which will
## replace the existing scale.</code></pre>
<pre><code>## Joining, by = &quot;label&quot;
## Joining, by = &quot;node&quot;
## Joining, by = &quot;n&quot;</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>hindPC1.res<span class="sc">$</span>plot</span></code></pre></div>
<p><img src="mod6_proj_files/figure-html/newplot-1.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>hindPC1.res<span class="sc">$</span>res</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##       n rate.difference p.value clade                      
##   &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;                      
## 1   225        -0.00194   0.001 Macroheterocera: Noctuoidea</code></pre>
<p>Notice that the clades and their taxa are color coded and the
exceptional shifts are indicated by triangles (blue and down for low
shifts, red and up for high shifts). Now we have a method of indicating
what clades/lineages underwent a shift and the scale of the shift.</p>
</div>
<div id="shape-evolution-correlation" class="section level2">
<h2>Shape evolution correlation</h2>
<p>To say something about whether hing- and forewing shape evolution is
correlated we could undertake phylogenetic least squares analysis like
we have in previous projects. But, we’ve done a ton already. So, let’s
make this simple and just perform <a
href="https://en.wikipedia.org/wiki/Phylogenetic_comparative_methods#:~:text=Phylogenetically%20independent%20contrasts,-The%20standardized%20contrasts&amp;text=The%20logic%20of%20the%20method,statistically%20independent%20and%20identically%20distributed.">phylogenetic
independent contrasts (PIC)</a> analysis. First proposed by <span
class="citation">Felsenstein (1985)</span> in his seminal paper, he
proposed using phylogenetic information (under a Brownian-motion like
model) to transform the original tip data into values that are
statistically independent of one another. This method is captured in the
<code>ape</code> function <code>pic()</code> For hindwing and forewing
PC1, such analysis would look like this.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>hindPC1.pic <span class="ot">&lt;-</span> <span class="fu">pic</span>(hind.pc1,<span class="at">phy =</span> lep.tree2)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>forePC1.pic <span class="ot">&lt;-</span> <span class="fu">pic</span>(fore.pc1,<span class="at">phy =</span> lep.tree2)</span></code></pre></div>
<p>Here we just inputed our store PC vectors we used in the rate
analysis and our tree of course. Now we have transformed values we can
regress against one another. Let’s first plot them and see what we
get.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>PC1.pic <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">hind=</span>hindPC1.pic,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fore=</span>forePC1.pic</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>PC1.pic <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>fore,<span class="at">y=</span>hind))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="mod6_proj_files/figure-html/picplot-1.png" width="672" /></p>
<p>Wow! These PC1s Look pretty correlated! Let’s see what the r-squared
value is and if there is a significant relationship. For this, we need
simply to create a linear model and retrieve these values with
<code>summary()</code>.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(hind<span class="sc">~</span>fore,PC1.pic))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hind ~ fore, data = PC1.pic)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -0.0260329 -0.0040299 -0.0001764  0.0048320  0.0272273 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  1.629e-05  5.845e-04   0.028    0.978    
## fore        -8.335e-01  7.209e-02 -11.562   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.007552 on 165 degrees of freedom
## Multiple R-squared:  0.4476, Adjusted R-squared:  0.4442 
## F-statistic: 133.7 on 1 and 165 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div id="project-report" class="section level1">
<h1>Project Report</h1>
<p>Please submit your report to your team GitHub repository as an .Rmd
document with HTML output that addresses the following:</p>
<ul>
<li>Are the rates of wing-shape evolution different between the hind-
and forewing? By how much?</li>
<li>Have major lineages of the Lepidoptera undergone significant shifts
in evolutionary rate?</li>
<li>Are hind- and forewing shapes correlated?</li>
</ul>
<p>Please be sure to answer this question based on both PC1 and PC2
shape scores.</p>
<p>In answering your question, your .Rmd should include the following
components:</p>
<ul>
<li>A YAML header that specifies HTML output, the authors, and a
bibliograph named “BIOL3140.bib”. <strong>Submit this bibliography as
well!</strong></li>
<li>Sections including an introduction, methods, results, discussion,
author contributions, and references. Make sure that each, aside from
the references, includes one to two short paragraphs. Specifially:
<ul>
<li>Introduction: Frame the questions, indicating why they are
important, what background work has been done in this realm, and how you
will answer them. <strong>Please include at least one reference to
support the summary of previous work.</strong> Note: this can be done
easily by refiguring the introduction to this project report.</li>
<li>Methods: Explicitly state how you answered the questions, including
a narrative of all the anlyses both qualitative and quantitative.</li>
<li>Results: Include any appropriate figures or tables and a narrative
of the main results that are important to answering the questions.</li>
<li>Discussion: Succinctly declare how the results relate to the
question and how they compare to previous work devoted to the topic. In
addition, be sure to comment on the importance of your findings to the
broader topic at hand. <strong>Please include at least one reference to
another relevant study.</strong> Note: circling back to the
introductions, both to this project description and yours, will be
helpful here.</li>
<li>Author contributions: Briefly outline what each team member
contributed to the project.</li>
</ul></li>
</ul>
<p>Project reports should be uploaded by 11:59 PM on Sunday, November
5th.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-castiglione2018new" class="csl-entry">
Castiglione, Silvia, Gianmarco Tesone, Martina Piccolo, Marina
Melchionna, Alessandro Mondanaro, Carmela Serio, Mirko Di Febbraro, and
Pasquale Raia. 2018. <span>“A New Method for Testing Evolutionary Rate
Variation and Shifts in Phenotypic Evolution.”</span> <em>Methods in
Ecology and Evolution</em> 9 (4): 974–83.
</div>
<div id="ref-felsenstein1985phylogenies" class="csl-entry">
Felsenstein, Joseph. 1985. <span>“Phylogenies and the Comparative
Method.”</span> <em>The American Naturalist</em> 125 (1): 1–15.
</div>
<div id="ref-jantzen2008hindwings" class="csl-entry">
Jantzen, Benjamin, and Thomas Eisner. 2008. <span>“Hindwings Are
Unnecessary for Flight but Essential for Execution of Normal Evasive
Flight in Lepidoptera.”</span> <em>Proceedings of the National Academy
of Sciences</em> 105 (43): 16636–40.
</div>
<div id="ref-kawahara2019phylogenomics" class="csl-entry">
Kawahara, Akito Y, David Plotkin, Marianne Espeland, Karen Meusemann,
Emmanuel FA Toussaint, Alexander Donath, France Gimnich, et al. 2019.
<span>“Phylogenomics Reveals the Evolutionary Timing and Pattern of
Butterflies and Moths.”</span> <em>Proceedings of the National Academy
of Sciences</em> 116 (45): 22657–63.
</div>
<div id="ref-kratsch2014ridgerace" class="csl-entry">
Kratsch, Christina, and Alice C McHardy. 2014. <span>“RidgeRace: Ridge
Regression for Continuous Ancestral Character Estimation on Phylogenetic
Trees.”</span> <em>Bioinformatics</em> 30 (17): i527–33.
</div>
<div id="ref-o2006testing" class="csl-entry">
O’Meara, Brian C, Cécile Ané, Michael J Sanderson, and Peter C
Wainwright. 2006. <span>“Testing for Different Rates of Continuous Trait
Evolution Using Likelihood.”</span> <em>Evolution</em> 60 (5): 922–33.
</div>
<div id="ref-penz2003phylogenetic" class="csl-entry">
Penz, Carla M, and Djunijanti Peggie. 2003. <span>“Phylogenetic
Relationships Among Heliconiinae Genera Based on Morphology
(Lepidoptera: Nymphalidae).”</span> <em>Systematic Entomology</em> 28
(4): 451–79.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
