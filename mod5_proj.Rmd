---
title: "Module 5 Project"

---
<style>
div.green { background-color:#c7d1c0; border-radius: 5px; padding: 20px;}
</style>
<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">

# Introduction

Now that we have learned the basics of data analysis, visualization, and modeling. Let's move on to how we collect data in the first place. So much of experimental work in organismal biology requires specialized equipment. Often, equipment is expensive or devices and instruments needed for the work aren't commercially available. Because of the expense and unique requirements of instruments, organismal biologist often make their own. Prototyping instruments can be tedious and challenging, often requiring collaboration with engineers or other technical consultants. However, many simple sensor-based instruments that fit the requirements of researchers can be built around Arduino, an open source, inexpensive prototyping platform. 

In this project, we'll proceed with prototyping a simple sensor, one that can very accurately record temperature. This project assumes you have worked through the the assigned readings and links and therefore understand how an Arduino Uno (or a clone) is programmed and how serial data are sent and received from an Arduino.

# Set up

## Materials

Assemble the following materials from your DaqPacks

  + DHT11 precision linear analog temperature sensor
  + Elegoo Arduino Uno clone
  + variety of jumper or prototyping wires
  
# Assembly and Programming

## Assembly
Be sure to read this post about [Using a DHT11 Sensor](https://learn.adafruit.com/dht/using-a-dhtxx-sensor)---it provides a good overview of this temp sensor and explicit instructions for assembling and programming an Arduino-based temperature recording system.

Let's start with assembly. First, we'll wire the three pins of the DHT11 according the this diagram (ignore the resistor component):


<center>
<img src="https://arduinogetstarted.com/images/tutorial/arduino-dht11-temperature-humudity-module-wiring-diagram.jpg" alt="alternatetext">
</center>
<br>

**NOTE** Be very careful wiring this sensor. Be sure of the following, otherwise you may fry the sensor:

  + The "+" or "VCC" pin on the sensor module is wired to the 5V pin on the Arduino and 
  + The "GND" or "-" pin on the sensor is wired to the GND pin on the Arduino
  + The "S" pin on the sensor is wired to a digital pin on the Arduino (D2 will do).

## Programming

Begin by reading Adafruit's [programming guide for this sensor](https://learn.adafruit.com/dht/using-a-dhtxx-sensor). You'll have to add the DHT library to your Arduino IDE following the directions in the guide. While adding the library, you may see a prompt asking if you'd like to also install missing dependencies (things the DHT library also needs to run). Go ahead and click "install all". 

Once the library is installed, click on **File &#8594; Examples &#8594; DHT &#8594; DHTtester** to open an sketch. You may have to close and restart the IDE for the DHT example sketch to appear. Follow the directions in the guide to modify the sketch for use with the DHT11 sensor, namely that you'll have to comment out the line defines the sensor as a DHT2222 and uncomment the line that defines it as a DHT11. It should look like this:

```{}  
/ Uncomment whatever type you're using!
#define DHTTYPE DHT11   // DHT 11
//#define DHTTYPE DHT22   // DHT 22  (AM2302), AM2321
//#define DHTTYPE DHT21   // DHT 21 (AM2301)
```

If everything is in order---you've chosen the right port and board in Arduino IDE---you can now click on the serial monitor icon in the upper right of the IDE (or pres "cmd/ctrl+shift+m") to see what data are being printed from the microcontroller to your computer over the serial (USB) port. It should look something like this. If so, CONGRATS! You're recording temperature data!

<div class = "green">
<div class="row">
  <div class="col-sm-2"><a class="far fa-sticky-note fa-5x" style="color:#939681"></a> <!-- regular style --></div>
  <div class="col-sm-9">When getting setup with your Arduino, make sure you've selected the correct board and port from the "Tools" dropdown menu in the IDE!
</div>
</div>
</div>
<br>

<center>
![FigName](tempserial.png)
</center>
<br>

Notice the serial monitor is ouputting data from the Arduino that include humidity, temperature (in °C and °F) and heat index (in °C and °F). This is great, but as a scientist, you're probably building this instrument to record temperature over some length of time. Thus, reporting when, relative to the start of the experiment, the temperature was recorded is important. In addition, we're using this sensor to give us temperature in readings in °C and we don't much care about all the other stuff. Fortunately, modifying the output is a piece of cake.

First, recording and printing time to the serial connection is super easy. We can do this by adding a new variable `currentTime` and passing a time value in milliseconds to this variable in the void loop. First, add `int currentTime;` to the top of the sketch where the other variables are established. `int` establishes the variable as an integer, which is just fine because milliseconds is recorded as whole numbers. Second, add this to the `void(loop)`:

```{}  
  //add line to record current time 
  currentTime=millis(); 
 
  //add line to print current time 
  Serial.print("Time = ");
  Serial.println(currentTime);
```

This first line above records the time in milliseconds. The second and third lines print a prefix and the value for the current time. Notice there's `Serial.print()` and `Serial.println()`. The later is identical to the former, however, `Serial.println` prints the value and then a new line. 

An amended code looks something like this:

```{}
// Example testing sketch for various DHT humidity/temperature sensors
// Written by ladyada, public domain

// REQUIRES the following Arduino libraries:
// - DHT Sensor Library: https://github.com/adafruit/DHT-sensor-library
// - Adafruit Unified Sensor Lib: https://github.com/adafruit/Adafruit_Sensor

#include "DHT.h"

#define DHTPIN 2     // Digital pin connected to the DHT sensor
// Feather HUZZAH ESP8266 note: use pins 3, 4, 5, 12, 13 or 14 --
// Pin 15 can work but DHT must be disconnected during program upload.

// Uncomment whatever type you're using!
//#define DHTTYPE DHT11   // DHT 11
#define DHTTYPE DHT22   // DHT 22  (AM2302), AM2321
//#define DHTTYPE DHT21   // DHT 21 (AM2301)

// Connect pin 1 (on the left) of the sensor to +5V
// NOTE: If using a board with 3.3V logic like an Arduino Due connect pin 1
// to 3.3V instead of 5V!
// Connect pin 2 of the sensor to whatever your DHTPIN is
// Connect pin 3 (on the right) of the sensor to GROUND (if your sensor has 3 pins)
// Connect pin 4 (on the right) of the sensor to GROUND and leave the pin 3 EMPTY (if your sensor has 4 pins)
// Connect a 10K resistor from pin 2 (data) to pin 1 (power) of the sensor

// Initialize DHT sensor.
// Note that older versions of this library took an optional third parameter to
// tweak the timings for faster processors.  This parameter is no longer needed
// as the current DHT reading algorithm adjusts itself to work on faster procs.
DHT dht(DHTPIN, DHTTYPE);

//adding time variable
int currentTime
  
void setup() {
  Serial.begin(9600);
  Serial.println(F("DHTxx test!"));

  dht.begin();
}

void loop() {
  // Wait a few seconds between measurements.
  delay(2000);

  // Reading temperature or humidity takes about 250 milliseconds!
  // Sensor readings may also be up to 2 seconds 'old' (its a very slow sensor)
  float h = dht.readHumidity();
  // Read temperature as Celsius (the default)
  float t = dht.readTemperature();
  // Read temperature as Fahrenheit (isFahrenheit = true)
  float f = dht.readTemperature(true);

  // Check if any reads failed and exit early (to try again).
  if (isnan(h) || isnan(t) || isnan(f)) {
    Serial.println(F("Failed to read from DHT sensor!"));
    return;
  }

  // Compute heat index in Fahrenheit (the default)
  float hif = dht.computeHeatIndex(f, h);
  // Compute heat index in Celsius (isFahreheit = false)
  float hic = dht.computeHeatIndex(t, h, false);

 //add line to record current time 
  currentTime=millis(); 
 
  //add line to print current time 
  Serial.print("Time = ");
  Serial.println(currentTime);
  Serial.print(F("Humidity: "));
  Serial.print(h);
  Serial.print(F("%  Temperature: "));
  Serial.print(t);
  Serial.print(F("°C "));
  Serial.print(f);
  Serial.print(F("°F  Heat index: "));
  Serial.print(hic);
  Serial.print(F("°C "));
  Serial.print(hif);
  Serial.println(F("°F"));
}


```

Check in on the serial monitor. Notice that there's now a new line (outlined below in red) that reports time in milliseconds:

![FigName](tempserial2.png)
</center>
<br>

Notice that the data are being printed about ever second (2000 ms) or so. This is because the first line of the `void(loop)` is `delay(2000)`. The `delay()` function delays or stops the loop for a specified number of milliseconds.

OK, this much better, but, as we learned in Module 2, data need to be parsed (i.e., arranged) in particular ways for a scientists to read data into a computer and then work with it. One of the standard parsing conventions or formats is comma separated values (.csv). If we can get our data to be printed to the serial monitor separated by commas, then we just have to copy the data from the the serial monitor and paste it into a text file. Later in the course, we'll learn how to save the data to an SD card, but for now, let's set up serial printing so that we can copy it. 

To do this, we need to rearrange and add some `Serial.print()` commands to the `void(loop)` section that controls printing. So rather than . . . 

```{}
  //add line to record current time 
  currentTime=millis(); 
  
  //add line to print current time 
  Serial.print("Time = ");
  Serial.println(currentTime);
  Serial.print(F("Humidity: "));
  Serial.print(50);
  Serial.print(F("%  Temperature: "));
  Serial.print(22);
  Serial.print(F("°C "));
  Serial.print(74);
  Serial.print(F("°F  Heat index: "));
  Serial.print(22);
  Serial.print(F("°C "));
  Serial.print(74);
  Serial.println(F("°F"));
  
```

 . . . let's ditch the prefixes and unneeded data and print some commas. Notice the last serial print command is  `Serial.println()` to start a new line before the next data are printed.
 
```{}
 //print current time 
  Serial.print(currentTime);
 //print a comma 
  Serial.print(",");
  Serial.println(t);
  
```

Now we're only printing time (in ms) and temperature (in °C). If your wondering where the `t` variable comes from, it's this line in the loop that reads temperature from the module and stores it.
 
 ```{}
 // Read temperature as Celsius (the default)
  float t = dht.readTemperature();
  ```
  
Upload the sketch and have a look at the serial monitor. Notice that we have data for milliseconds and temp in &deg;C separated by commas. That is, we have comma separated values (.csv)! There's just one problem with this---unless you knew the inner workings of this sketch, you wouldn't know which data were which. Is the first value time or temperature? Printing a header at the beginning of the program is the solution. After this, the header and data can be copied and pasted to a text file and any computing operations that follow will logically parse and have a name for each column or position in the series of data. 

Here's how to proceed. Merely print some header/column names in the `setup(void)`. The `setup(void)` is a part of the sketch where you ask the microcontroller to do something once and *before* `void(loop)` commences, a perfect place to print the header to the serial port.

```{}
//add header
Serial.println("ms,degC");
```

After adding this and uploading the modified sketch, the serial monitor should now print a header (i.e., column names) and then the data like this:

![FigName](tempserial4.png)
</center>
<br>

This new modified Arduino sketch follows here:

```{}
// Example testing sketch for various DHT humidity/temperature sensors
// Written by ladyada, public domain

// REQUIRES the following Arduino libraries:
// - DHT Sensor Library: https://github.com/adafruit/DHT-sensor-library
// - Adafruit Unified Sensor Lib: https://github.com/adafruit/Adafruit_Sensor

#include "DHT.h"

#define DHTPIN 2     // Digital pin connected to the DHT sensor
// Feather HUZZAH ESP8266 note: use pins 3, 4, 5, 12, 13 or 14 --
// Pin 15 can work but DHT must be disconnected during program upload.

// Uncomment whatever type you're using!
//#define DHTTYPE DHT11   // DHT 11
#define DHTTYPE DHT22   // DHT 22  (AM2302), AM2321
//#define DHTTYPE DHT21   // DHT 21 (AM2301)

// Connect pin 1 (on the left) of the sensor to +5V
// NOTE: If using a board with 3.3V logic like an Arduino Due connect pin 1
// to 3.3V instead of 5V!
// Connect pin 2 of the sensor to whatever your DHTPIN is
// Connect pin 3 (on the right) of the sensor to GROUND (if your sensor has 3 pins)
// Connect pin 4 (on the right) of the sensor to GROUND and leave the pin 3 EMPTY (if your sensor has 4 pins)
// Connect a 10K resistor from pin 2 (data) to pin 1 (power) of the sensor

// Initialize DHT sensor.
// Note that older versions of this library took an optional third parameter to
// tweak the timings for faster processors.  This parameter is no longer needed
// as the current DHT reading algorithm adjusts itself to work on faster procs.
DHT dht(DHTPIN, DHTTYPE);

//adding time variable
int currentTime;

void setup() {
  Serial.begin(9600);
  Serial.println(F("DHTxx test!"));

  dht.begin();

  //add header
  Serial.println("ms,degC");
}

void loop() {
  // Wait a few seconds between measurements.
  delay(2000);

  // Reading temperature or humidity takes about 250 milliseconds!
  // Sensor readings may also be up to 2 seconds 'old' (its a very slow sensor)
  float h = dht.readHumidity();
  // Read temperature as Celsius (the default)
  float t = dht.readTemperature();
  // Read temperature as Fahrenheit (isFahrenheit = true)
  float f = dht.readTemperature(true);

  // Check if any reads failed and exit early (to try again).
  if (isnan(h) || isnan(t) || isnan(f)) {
    Serial.println(F("Failed to read from DHT sensor!"));
    return;
  }

  // Compute heat index in Fahrenheit (the default)
  float hif = dht.computeHeatIndex(f, h);
  // Compute heat index in Celsius (isFahreheit = false)
  float hic = dht.computeHeatIndex(t, h, false);

  //add line to record current time
  currentTime = millis();

  //print current time
  Serial.print(currentTime);
  //print a comma
  Serial.print(",");
  Serial.println(t);
}
```


# Saving Data from the Serial Monitor

It would be very easy to integrate another piece of hardware, namely and SD card board, to save data. However, for this module and the other that requires Arduino data, saving your data for now can be as simple as copying the data printed to the serial monitor and pasting it into a text file. The code we're working with produces comma-separated values for easy reading into analysis software, like R. 

Be sure to copy your data into a text file, not a Word document or Excel. I suggest using a free text editing like [BBedit (for Mac)](https://www.barebones.com/products/bbedit/download.html) or [Notepadd++ (for Windows)](https://notepad-plus-plus.org/downloads/). 

## Working with metadata

```{r,include=F}

library(tidyverse)

nm <- c("Hansel","Derek","Mugato","Matilda")

for(i in nm){
  for(w in c("couch","active")){
  hot.i <- data.frame(ms=seq(1,100000,1000),degC=degC <-runif(100,37,39))
  hot.i <- hot.i%>%
    mutate(degC=round(degC,2))
  
  cold.i <- data.frame(ms=seq(1,100000,1000),degC=degC.c <-runif(100,36,38))
  cold.i <- cold.i%>%
    mutate(degC=round(degC,2))
  write_csv(cold.i,path=paste0(i,"_",w,".csv"))
}
}



list.files(pattern = "couch|active.csv")
  
```

When saving data in a research project, be sure to give the data a standard and informative file name. This is **essential for saving data**. For instance, say we were studying the effect of exercise on body temperature in four human subjects: [Derek, Hansel, Matilda, and Mugato](https://www.youtube.com/watch?v=NQ-8IuUkJJc). Imagine that we measured body temperature over 100 seconds, twice for each subject, once when they were inactive (on the couch) and once after 5 minutes of jumping jacks (active). A logical file-naming convention would be "Name_couch/active.csv". 
So, say we have these 4 subjects and two experimental conditions, we'd have the following 8 files:

 + "Derek_active.csv"
 + "Derek_couch.csv"
 + "Hansel_active.csv"
 + "Hansel_couch.csv"  
 + "Matilda_active.csv" 
 + "Matilda_couch.csv"
 + "Mugato_active.csv"
 + "Mugato_couch.csv"  

Giving files a name describing the experiment (who and condition in this case) is an easy way of storing **metadata** (data about the data). For any subsequent analysis, we can pull the metadata from the file name and store our data with these conditions stored as columns. If we consider loading data with R, the power of a `for` loop because apparent. Using a `for` loop, we can iteratively load each data file, strip the metadata, and store both in a table. In this example, such a loop might look like this:

```{r,message=FALSE}
library(tidyverse)
dat.f <- list.files(pattern = "couch|active.csv") #find the files

dat.l <- list() #make an empty list

for(i in dat.f){
  met.dat<- unlist(strsplit(i,"_")) #split of the filename string
  who <- met.dat[1] #store the first element
  activity <- gsub(".csv","",met.dat[2]) #store second element, dropping CSV with gsub()
  dat.l[[i]]<- read_csv(i)%>%
    mutate(who=who,activity=activity) #read, then store data with additional columns of metada in list as position unique to i
  
}
dat <- do.call(rbind,dat.l) #combine the list into table

dat%>%
  ggplot()+geom_boxplot(aes(x=activity,y=degC))+facet_grid(.~who) #plot to see what we get

```

A workflow like this, formulated around standardized file names containing metadata, is eminently scalable. Eight or a 1000 files, this approach works well.


# Project Report

In this project report, we'll mirror the process of future projects and reports in Phase II and III of the course. Specifically, we'll define a question, get data with a prototyped Arduino-based sensor and data-acquisition system, analyze and visualize it in R, and answer the question in an R Markdown report. For this report, we'll simply ask *Does body temperature vary in human subjects according to activity level?*.

To answer this question, use your new Arduino temp sensor to record the body temperature of each group member for a 100 s while sitting on the couch (or during some other calm activity---but make sure each group member does the same thing!) and after 5 minutes of doing jumping jacks.  Record axillary temperature by putting the sensor in your armpit. 

Make sure, in your project, you:

  + Record data from the active and inactive conditions for all group members.
  + Save data from the serial monitor via copy and paste operations, giving each text file a descriptive, standardized file name containing metadata.
  + Combine all data from your team into one table.
  + Plot mean temperature +/- 1 standard deviation, focusing on the comparison of activities between subjects. 
  
  
This report will require you to submit an .Rmd with HTML output that includes all the sections required of future project reports. Keep each section short, including only 3-4 sentences. Here are some key components to include:


  + Find and cite a study in the introduction that frames the question, i.e., what is known about the effect of activity on body temperature.
  + Qualitatively assess the effect of activity on body temperature with a single concise figure in the results section. Be sure to include a short narrative of the findings.
  + Find, cite, and comment on a study in the discussion that frames the results, i.e., are your result congruent or not with previous findings and why? 
  + In the author contributions section, include short, explicit statements of each team member's role in executing the project. 
  
Push your .Rmd to the projects directory established for each team on GitHub. **Submissions are due by 11:59 pm on Tuesday, October 11th.**

Good luck!!


